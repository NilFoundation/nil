## Overview

`nild` is the =nil; daemon. It can be configured to perform various services:
* _validator node_, processing messages and creating new blocks
  in one or more shards;
* _archive node_, storing the complete history of the blockchain;
* _RPC node_, providing API service to users and applications;
* _Cometa service_, storing Solidity source code for smart contracts;
* the _faucet_, distributing tokens to users of the =nil; testnet.

The latter two services (Cometa and faucet) are provided
by separate daemons in a production setting.

In this document, we will demonstrate two typical ways of setting up
a local devnet with `nild` and document how to configure and launch them.

## Devnet in a single process

This setup enables you to create a fully standalone =nil; blockchain, with
multiple shards operating within a single process on a single machine. This
configuration is particularly useful for testing purposes and for familiarizing
yourself with the technology.

Run:
```shell
nild run --http-port=8529
```

This will launch a local cluster with the following default settings:
* `--db-path ./test.db`: database stored in `./test.db` (created if not existing, but not deleted if an incompatible old database is present);
* `--nshards 5`: 4 working shards, plus a main shard, all collated by this instance of `nild`;
* HTTP RPC API on `127.0.0.1:8529`, with the faucet API enabled;
* Cometa endpoint on `127.0.0.1:8528`.

If an incompatible old database is found in the specified `db-path`, `nild` will
refuse to start by default. If you are working with test databases that can be
safely discarded, you can use the `--allow-db-clear` option to automatically
delete the incompatible database and proceed with the startup.

## Complete devnet with 2 validators, an archive node and an RPC node

To start a devnet with multiple validators, we need to assign them identities by
generating cryptographic keys and bootstrap the network by informing validators
about each other. This can be achieved using the devnet generator, available
through the `nild devnet` subcommand.

First, write a devnet spec as a YAML file:
```yaml
nild_config_dir: myDevnet/conf
nild_credentials_dir: myDevnet/creds
nild_p2p_base_tcp_port: 30303
nil_wipe_on_update: true
nShards: 5
nil_config:
  - { id: 0, shards: [ 0, 1 ], splitShards: true, dhtBootstrapPeersIdx: [1] }
  - { id: 1, shards: [ 2, 3, 4 ], splitShards: true, dhtBootstrapPeersIdx: [0] }
nil_archive_config:
  - { id: 0, shards: [ 0, 1, 2, 3, 4 ], bootstrapPeersIdx: [ 0, 0, 1, 1 ], dhtBootstrapPeersIdx: [0, 1] }
nil_rpc_config:
  - id: 0
    dhtBootstrapPeersIdx: [ 0, 1 ]
    archiveNodeIndices: [ 0 ]
```

Save the spec to `myDevnet.yaml`.

You can tweak the amount of shards and validators, the distribution
of shards between validators etc. The `bootstrapPeersIdx` and
`dhtBootstrapPeersIdx` settings are lists of validators IDs in this
spec.

Now you can generate validator identities and config files by running:
```shell
$ nild devnet myDevnet.yaml --basedir myDevnet/var
```

The configuration files will be created in `myDevnet/conf`. Now you can
start the services by running:
```
$ nild run --config myDevnet/conf/nil-0  # start first validator
$ nild run --config myDevnet/conf/nil-1  # start second validator
$ nild archive --config myDevnet/conf/nil-archive-0  # start archive node
$ nild rpc --config myDevnet/conf/nil-rpc-0  # start RPC node
```

In this setup, there is no faucet or Cometa, which have to be configured
and launched separately.
