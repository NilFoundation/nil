# Tokens support

This tutorial explains how =nil; handles tokens and multi-token operations.

## Definition

=nil; supplies a basic 'default' token (NIL).

The network also has a multi-token mechanism. All accounts (smart contracts) can be paid in any number of arbitrary tokens created either by the account owner or other accounts.

:::info

While custom tokens can be transferred between accounts, they cannot be used for paying for essential functionalities of =nil; such as deploying contracts or sending async calls.

:::

:::info

A contract can only be the owner of one token. While non-owners can transfer different tokens between accounts, they cannot mint any tokens that they do not own.

:::

## Usage

### Via the CLI

To create a new token and withdraw it to the address of the owner:

```bash file=../../../tests/multi-tokens-support.test.mjs start=startBasicCreateTokenCommand end=endBasicCreateTokenCommand
```

```bash file=../../../tests/multi-tokens-support.test.mjs start=startBasicWithdrawTokenCommand end=endBasicWithdrawTokenCommand
```

To mint an existing token (which automatically withdraws it to the owner):

```bash file=../../../tests/multi-tokens-support.test.mjs start=startMintExistingTokenCommand end=endMintExistingTokenCommand
```

To burn an existing token (the supply is automatically reduced at the address of the owner):

```bash file=../../../tests/multi-tokens-support.test.mjs start=startBurnExistingTokenCommand end=endBurnExistingTokenCommand
```

### Via the client library

To create a new token and withdraw it:

```ts showLineNumbers file=../../../tests/multi-tokens-support.test.mjs start=startBasicNilJSExample end=endBasicNilJSExample
```

To burn an existing token:

```ts showLineNumbers file=../../../tests/multi-tokens-support.test.mjs start=startNilJSBurningExample end=endNilJSBurningExample
```

### Via the `smart-contracts` package

It is also possible to create custom tokens as separate smart contracts with built-in burning and minting functionality.

The `smart-contracts` NPM package contains the `NilTokenBase.sol` contract. To create a new custom token as a smart contract, simply inherit a new smart contract from `NilTokenBase.sol` and deploy it. 

```solidity showLineNumbers
import "@nilfoundation/smart-contracts/contracts/NilTokenBase.sol";

contract NewToken is NilTokenBase {}
```

`NilTokenBase.sol` provides internal methods for burning, minting and sending tokens, as well as [**`onlyExternal` wrappers**](../../tools/sol-library/func-modifiers.mdx) over these methods. 

Here is a basic implementation of an NFT contract inheriting from `NilTokenBase.sol`:

```solidity showLineNumbers file=../../../tests/NFT.sol start=startContract end=endContract
```

The contract uses the `openzeppelin/Ownable.sol` contract to manage NFT ownership. It also overrides `onlyExternal` methods from `NilTokenBase.sol` to ensure that no one can burn or mint the NFT. 

## Example

This example creates a smart account that stores three tokens: the default token, and two custom tokens.

Create two new smart accounts:

```ts showLineNumbers file=../../../tests/multi-tokens-support.test.mjs start=startAdvancedNilJSExample end=endAdvancedNilJSExample
```

Create a new token for Smart account 1 and withdraw it:

```ts showLineNumbers file=../../../tests/multi-tokens-support.test.mjs start=startAdvancedNilJSMintingExample end=endAdvancedNilJSMintingExample
```

Create a new token for Smart account 2 and send it to Smart account 1:

```ts showLineNumbers file=../../../tests/multi-tokens-support.test.mjs start=startNilJSTransferExample end=endNilJSTransferExample
```

## Token faucet service

The token faucet is a special service whose main purpose is to distribute default cluster tokens (NIL) that are used to pay for contract deployment and transaction execution. In addition, the faucet also distributes various pre-set 'mock' tokens such as USDC and BTC.

Each token faucet resides at a different address. To withdraw a specific token, simply call the corresponding address using the `faucet_TopUpViaFaucet` method.

### Usage

#### Via JSON-RPC API

The faucet service resides at the `http://api.devnet.nil.foundation/api/faucet/${USERNAME}/${TOKEN}` endpoint.

To see all active faucets:

```bash
curl -X POST http://api.devnet.nil.foundation/api/faucet/${USERNAME}/${TOKEN} \
-H "Content-Type: application/json" \
-d '{"jsonrpc": "2.0", "id": 0, "method": "faucet_getFaucets", "params": []}'
```

Expected response:

```bash
{
  "jsonrpc":"2.0",
  "id":0,
  "result":{
  "BTC":"0x0001111111111111111111111111111111111114",
  "ETH":"0x0001111111111111111111111111111111111112",
  "NIL":"0x0001111111111111111111111111111111111110",
  "USDT":"0x0001111111111111111111111111111111111113"}
}
```

To withdraw from a faucet:

```bash
curl -X POST http://api.devnet.nil.foundation/api/${USERNAME}/${TOKEN} \
-H "Content-Type: application/json" \
-d '{"jsonrpc": "2.0", "id": 0, "method": "faucet_topUpViaFaucet", "params": ["$FAUCET_ADDRESS", "$SMART_ACCOUNT_ADDRESS", $AMOUNT]}'
```

Expected output:

```bash
{
  "jsonrpc":"2.0",
  "id":0,
  "result": HASH
}
```

#### Via the client library

:::tip

Refer to [**the Codebook**](../../cookbook/faucet-service/use-faucet-service.mdx) for ready-made canonical examples on using the faucet service.

:::

Nil.js offers several 'helper' wrappers designed to simplify work with the faucet service.

To create a new faucet client:

```js showLineNumbers
const faucetClient = new FaucetClient({
	transport: new HttpTransport({
		endpoint: FAUCET_ENDPOINT,
	}),
});
```

To request a list of all faucets:

```js showLineNumbers
const faucets = await faucetClient.getAllFaucets();
```

To request tokens from a faucet:

```js showLineNumbers
await faucetClient.topUpAndWaitUntilCompletion({
  smartAccountAddress: SMART_ACCOUNT_ADDRESS,
  faucetAddress: FAUCET_ADDRESS,
  amount: AMOUNT,
});
```

#### Via the =nil; CLI

Refer to [**the =nil; CLI usage guide**](../../tools/nil-cli/usage.mdx#set-the-faucet-endpoint) to set up the faucet service with this tool.
