# Tokens and multi-currency support

This tutorial explains how =nil; handles tokens and multi-currency operations.

## Definition

=nil; supplies a basic 'default' currency (MZK). 

The network also has a multi-currency mechanism. All accounts (smart contracts) can be paid in any number of arbitrary currencies created either by the account owner or other accounts. 

:::info

While custom currencies can be transferred between accounts, they cannot be used for paying for essential functionalities of =nil; such as deploying contracts or sending async calls.

:::

:::info

A contract can only be the owner of one currency. While non-owners can transfer different currencies between accounts, they cannot mint any currencies that they do not own.

:::

## Usage

### Via the CLI

To create a new currency and withdraw it to the address of the owner:

```bash file=../../../tests/tokens-multi-currency-support.test.mjs start=startBasicCreateCurrencyCommand end=endBasicCreateCurrencyCommand
```

```bash file=../../../tests/tokens-multi-currency-support.test.mjs start=startBasicWithdrawCurrencyCommand end=endBasicWithdrawCurrencyCommand
```

To mint an existing currency (which automatically withdraws it to the owner):

```bash file=../../../tests/tokens-multi-currency-support.test.mjs start=startMintExistingCurrencyCommand end=endMintExistingCurrencyCommand
```

To burn an existing currency (the supply is automatically reduced at the address of the owner):

```bash file=../../../tests/tokens-multi-currency-support.test.mjs start=startBurnExistingCurrencyCommand end=endBurnExistingCurrencyCommand
```

### Via the client library

To create a new currency and withdraw it:

```ts file=../../../tests/tokens-multi-currency-support.test.mjs start=startBasicNilJSExample end=endBasicNilJSExample
```

To burn an existing currency:

```ts file=../../../tests/tokens-multi-currency-support.test.mjs start=startNilJSBurningExample end=endNilJSBurningExample
```


## Example

This example creates a wallet that stores three currencies: the default token, and two custom currencies.

### Via the CLI

Create a new wallet:

```bash file=../../../tests/tokens-multi-currency-support.test.mjs start=startWalletCreation end=endWalletCreation
```

Create a new currency with the new wallet as its owner and withdraw it:

```bash file=../../../tests/tokens-multi-currency-support.test.mjs start=startCurrencyOneCreationCommand end=endCurrencyOneCreationCommand
```

```bash file=../../../tests/tokens-multi-currency-support.test.mjs start=startCurrencyOneWithdrawalCommand end=endCurrencyOneWithdrawalCommand
```

Create another currency with another smart contract as its owner:

```bash file=../../../tests/tokens-multi-currency-support.test.mjs start=startCurrencyTwoCreationCommand end=endCurrencyTwoCreationCommand
```

Withdraw the new currency back to the wallet:

```bash file=../../../tests/tokens-multi-currency-support.test.mjs start=startCurrencyTwoWithdrawalCommand end=endCurrencyTwoWithdrawalCommand
```

Check the wallet currencies:

```bash file=../../../tests/tokens-multi-currency-support.test.mjs start=startWalletCurrenciesCommand end=endWalletCurrenciesCommand
```

The following response should appear:

```bash
Contract currencies:
Balance: 50000 CurrencyId=[CURRENCY_ID_ONE]
Balance: 30000 CurrencyId=[CURRENCY_ID_TWO]
```

### Via the client library

Create two new wallets:

```ts showLineNumbers file=../../../tests/tokens-multi-currency-support.test.mjs start=startAdvancedNilJSExample end=endAdvancedNilJSExample
```

Create a new currency for Wallet 1 and withdraw it:

```ts showLineNumbers file=../../../tests/tokens-multi-currency-support.test.mjs start=startAdvancedNilJSMintingExample end=endAdvancedNilJSMintingExample
```

Create a new currency for Wallet 2 and send it to Wallet 1:

```ts showLineNumbers file=../../../tests/tokens-multi-currency-support.test.mjs start=startNilJSTransferExample end=endNilJSTransferExample
```

## Currency faucet service

The currency faucet is a special service whose main purpose is to distribute default cluster tokens (MZK) that are used to pay for contract deployment and message execution. In addition, the faucet also distributes various pre-set 'mock' currencies such as USDC and BTC.

Each currency faucet resides at a different address. To withdraw a specific currency, simply call the corresponding address using the `faucet_TopUpViaFaucet` method.

### Usage

#### Via JSON-RPC API

The faucet service resides at the `http://api.devnet.nil.foundation/api/faucet/${USERNAME}/${TOKEN}` endpoint.

To see all active faucets:

```bash
curl -X POST http://api.devnet.nil.foundation/api/faucet/${USERNAME}/${TOKEN} \
-H "Content-Type: application/json" \
-d '{"jsonrpc": "2.0", "id": 0, "method": "faucet_getFaucets", "params": []}'
```

Expected response:

```bash
{
  "jsonrpc":"2.0",
  "id":0,
  "result":{
  "BTC":"0x0001111111111111111111111111111111111114",
  "ETH":"0x0001111111111111111111111111111111111112",
  "MZK":"0x000100000000000000000000000000000fa00ce7",
  "USDT":"0x0001111111111111111111111111111111111113"}
}
```

To withdraw from a faucet:

```bash
curl -X POST http://api.devnet.nil.foundation/api/faucet/${USERNAME}/${TOKEN} \
-H "Content-Type: application/json" \
-d '{"jsonrpc": "2.0", "id": 0, "method": "faucet_topUpViaFaucet", "params": ["$FAUCET_ADDRESS", "$WALLET_ADDRESS", $AMOUNT]}'
```

Expected output:

```bash
{
  "jsonrpc":"2.0",
  "id":0,
  "result": HASH
}
```

#### Via the client library

Nil.js offers several 'helper' wrappers designed to simplify work with the faucet service.

To create a new faucet client:

```js showLineNumbers
const faucetClient = new FaucetClient({
	transport: new HttpTransport({
		endpoint: RPC_ENDPOINT,
	}),
});
```

To request a list of all faucets:

```js showLineNumbers
const faucets = await faucetClient.getAllFaucets();
```

To request tokens from a faucet:

```js showLineNumbers
await faucetClient.topUpAndWaitUntilCompletion({
  walletAddress: WALLET_ADDRESS,
  faucetAddress: FAUCET_ADDRESS,
  amount: AMOUNT,
});
```
