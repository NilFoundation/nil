# Handling async execution

To support [**cross-shard communication**](principles.mdx#cross-shard-communication), =nil; supports smart contracts making async calls to one another directly in Solidity code. 

This tutorial provides a brief theoretical and practical primer on async execution, and gives suggestions on how this feature can be integrated into an application.

## Performing an async call

Consider a smart contract with the following code:

```sol showLineNumbers file=../../../tests/CallerAsync.sol start=startCallerAsync end=endCallerAsync
```

The `asyncCall()` function makes it possible for the contract to call a function in another smart contract regardless of the shard where this contract is located. There are no additional actions required for making async calls: simply adding `asyncCall()` and specifying its arguments is sufficient.

:::info

The `asyncCall()` function is a shortcut for executing a precompiled contract responsible for managing async calls across the cluster.

:::

:::tip

To initiate an async call, the 'caller' contract must have sufficient funds to pay for initiating a new message.

:::

:::info[Async calls on the same shard]

`asyncCall()` works even if the contract with the specified address is located on the same shard. The mechanism remains exactly the same as with cross-shard communications: the function will produce a new message, and the requested function in another contract will be executed whenever said message is processed by the shard. This usually occurs within the space of two-three blocks.

:::


## Examples

Consider two contracts deployed on two different shards in =nil;:

* Contract 1 (caller) is deployed on Shard 1
* Contract 2 (receiver) is deployed on Shard 2

There are two possible patterns for cross-shard communication between Contract 1 and Contract 2.

### Calling a contract on another shard

In this pattern, Contract 1 simply calls a function in Contract 2 without receiving a result. 

Contract 1 has the following structure:

```solidity showLineNumbers file=../../../tests/CallerAsyncBasicPattern.sol start=startCallerAsyncBasicPattern end=endCallerAsyncBasicPattern
```

Contract 2 has the following structure:

```solidity showLineNumbers file=../../../tests/Counter.sol start=startContract end=endContract
```

Whenever the `call()` function is called inside Contract 1, a new outgoing message is spawned. When Shard 2 picks up this message and processes it, Contract 2 calls its `increment()` function. After `getValue()` is called, the result should display the total number of times the `call()` function was executed by Contract 1.

### Callback pattern

In this pattern, Contract 1 calls a function inside Contract 2 that makes an async call back to Contract 1.

Contract 1 acts as a simple escrow mechanism:

```solidity showLineNumbers file=../../../tests/Escrow.sol start=startEscrow end=endEscrow
```

Contract 2 acts as a validator for escrow resolution:

```solidity showLineNumbers file=../../../tests/Validator.sol start=startValidator end=endValidator
```

Contract 2 triggers the `resolve()` function within Contract 1 as a callback but only if the escrow participants are two distinct addresses.